<%- include("../layouts/boilerplate") %>

<style>
  /* Existing styles (unchanged parts skipped for brevity) */
  .club-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 70px;
    padding: 40px;
  }

  .club-container a {
    text-decoration: none;
    color: black;
  }

  .club-card {
    width: 25%;
    min-width: 300px;
    max-width: 300px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: transform 0.3s ease;
  }

  .club-card:hover {
    transform: translateY(-5px);
  }

  .card-img-top {
    height: 200px;
    width: 100%;
    object-fit: cover;
  }

  .card-body {
    padding: 15px;
    text-align: center;
  }

  .card-title {
    margin-bottom: 10px;
  }

  /* Responsive cards */
  @media (max-width: 1200px) {
    .club-card {
      width: 33.33%;
    }
  }
  @media (max-width: 900px) {
    .club-card {
      width: 50%;
    }
  }
  @media (max-width: 600px) {
    .club-card {
      width: 100%;
    }
  }

  /* Search styles */
  .search-container {
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
  }

  .search-box {
    position: relative;
    display: flex;
    align-items: center;
    padding: 10px 30px;
    border: 2px solid #ccc;
    border-radius: 30px;
    background: white;
    transition: 0.3s;
    width: 350px;
  }

  .search-box:hover {
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  }

  .search-icon {
    color: #666;
    margin-right: 10px;
  }

  input {
    border: none;
    outline: none;
    font-size: 16px;
    width: 100%;
    background: transparent;
  }

  .search-button {
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgb(160, 237, 216);
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    transition: 0.3s;
  }

  .suggestions {
    position: absolute;
    top: 105%;
    left: 0;
    width: 100%;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    list-style-type: none;
    padding: 5px 0;
    margin-top: 5px;
    z-index: 1000;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    display: none;
  }

  .suggestion-item {
    padding: 10px;
    cursor: pointer;
    font-size: 16px;
    color: #333;
    transition: background 0.2s ease;
  }

  .suggestion-item:hover {
    background-color: #f8f8f8;
  }

  .navbar {
    margin-top: -20px;
    position: relative;
  }

  .profile-icon {
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgb(160, 237, 216);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    text-transform: uppercase;
    margin-right: 20px;
    transition: background 0.3s ease;
  }

  .profile-icon:hover {
    background: rgb(140, 217, 196);
  }

  /* ===== New Dropdown Styles ===== */
  .profile-dropdown {
    position: absolute;
    top: 60px;
    right: 5px;
    width: 280px;
    background: #1e1e1e;
    color: white;
    border-radius: 12px;
    box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.3);
    z-index: 999;
    display: none;
    flex-direction: column;
    padding: 20px 0;
    font-family: "Segoe UI", sans-serif;
  }

  .profile-dropdown.show {
    display: flex;
  }

  .profile-dropdown .profile-header {
    display: flex;
    align-items: center;
    padding: 0 20px 15px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .profile-dropdown .avatar {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: #3bd2ad;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    margin-right: 12px;
  }

  .profile-dropdown .profile-info {
    display: flex;
    flex-direction: column;
  }

  .profile-dropdown .profile-info span:first-child {
    font-weight: 600;
  }

  .profile-dropdown ul {
    list-style: none;
    margin: 10px 0 0;
    padding: 0;
  }

  .profile-dropdown ul li {
    padding: 12px 20px;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .profile-dropdown ul li:hover {
    background: #2e2e2e;
  }

  .logout-btn {
    color: #ff4d4d;
  }

  .logout-btn:hover {
    background: #3a1a1a;
    color: #ff9999;
  }

  a{
    text-decoration: none;
  }
</style>

<!-- Navbar -->
<nav class="navbar bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand"></a>
    <form
      class="d-flex col-4"
      style="margin-right: 50px; position: relative"
      role="search"
    >
      <div class="search-container">
        <div class="search-box">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          <input
            placeholder="Search for a college.."
            id="searchedCollege"
            class="input"
            name="searchedCollege"
            type="text"
            autocomplete="off"
          />
          <ul id="suggestions" class="suggestions"></ul>
        </div>
        <button class="search-button" onclick="handleSubmit(event)">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </button>
      </div>
    </form>

    <div class="profile-icon" onclick="toggleDropdown()">
      <%= user && user.studentName ? user.studentName.charAt(0).toUpperCase() :
      'U' %>
    </div>

    <!-- Dropdown menu -->
    <div class="profile-dropdown" id="profileDropdown">
      <div class="profile-header">
        <div class="avatar">
          <%= user && user.studentName ?
          user.studentName.charAt(0).toUpperCase() : 'U' %>
        </div>
        <div class="profile-info">
          <span
            ><%= user && user.studentName ? user.studentName : 'Guest' %></span
          >
          <small><%= user && user.email ? user.email : 'No email' %></small>
        </div>
      </div>
      <a href="/edit-profile" class="dropdown-link">Edit Profile</a>
      <a href="/event-registrations" class="dropdown-link"
        >Event Registrations</a
      >

      <button class="logout-btn">Sign Out</button>
    </div>
  </div>
</nav>

<!-- College Section -->
<main class="page">
  <section class="club-header" aria-labelledby="club-title">
    <div class="decor decor--radials" aria-hidden="true"></div>
    <div class="decor decor--grid" aria-hidden="true"></div>
    <div class="club-header__grid">
      <!-- Logo tile -->
      <button type="button" class="logo-tile" aria-label="Change college logo">
        <span class="logo-tile__glow" aria-hidden="true"></span>
        <span class="logo-tile__frame">
          <img
            src="<%= college && college.collegeLogo ? college.collegeLogo.url : 'https://via.placeholder.com/140' %>"
            alt="Logo of <%= college.college %>"
          />
        </span>
      </button>

      <!-- Copy -->
      <div class="club-copy">
        <h1 id="club-title" class="club-title">
          <%= college && college.college ? college.college : 'No College' %>
        </h1>
        <p class="club-desc">
          <b>Clubs:</b> <%= college.clubs ? college.clubs.length : 0 %>
        </p>
      </div>
    </div>
  </section>

  <section class="event-section">
    <div class="events-section">
      <div class="container">
        <div class="events-content">
          <div class="section-header">
            <h2 class="section-title">Clubs in <%= college.college %></h2>
            <p class="section-description">
              Explore all the active clubs in your college.
            </p>
          </div>

          <div class="events-grid">
            <% if (college && college.clubs && college.clubs.length > 0) { %> <%
            college.clubs.forEach(club => { %>
            <a href="/<%= club.ClubName %>/profile" class="club-navigation">
              <div class="event-card">
                <div class="card-image-container">
                  <img
                    src="<%= club.ClubLogo.url %>"
                    alt="Logo of <%= club.ClubName %>"
                    class="card-image"
                  />
                </div>
                <div class="card-content">
                  <h3 class="card-title"><%= club.ClubName %></h3>
                  <p class="card-description">
                    <strong>Total Events:</strong>
                    <%= club.events ? club.events.length : 0 %>
                  </p>
                </div>
              </div>
            </a>
            <% }); %> <% } else { %>
            <p class="no-events">No clubs available.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>


  <!-- Scripts -->
  <script>
    function toggleDropdown() {
      const dropdown = document.getElementById("profileDropdown");
      dropdown.classList.toggle("show");
    }

    document.addEventListener("click", function (e) {
      const dropdown = document.getElementById("profileDropdown");
      const icon = document.querySelector(".profile-icon");
      if (!dropdown.contains(e.target) && !icon.contains(e.target)) {
        dropdown.classList.remove("show");
      }
    });

    function handleSubmit(event) {
  event.preventDefault();
  const query = document.getElementById("searchedCollege").value.trim();
  if (query) {
    window.location.href = `/index?searchedCollege=${encodeURIComponent(query)}`;
  }
}

    document.addEventListener("DOMContentLoaded", function () {
      const searchInput = document.getElementById("searchedCollege");
      const suggestionsBox = document.getElementById("suggestions");

      searchInput.addEventListener("input", async function () {
        const query = searchInput.value.trim();

        if (query.length === 0) {
          suggestionsBox.innerHTML = "";
          suggestionsBox.style.display = "none";
          return;
        }

        try {
          const response = await fetch(`/search-colleges?q=${query}`);
          const colleges = await response.json();

          suggestionsBox.innerHTML = "";
          suggestionsBox.style.display = "block";

          colleges.forEach((college) => {
            const listItem = document.createElement("li");
            listItem.textContent = college.name;
            listItem.classList.add("suggestion-item");

            listItem.addEventListener("click", function () {
              searchInput.value = college.name;
              suggestionsBox.innerHTML = "";
              suggestionsBox.style.display = "none";
              document.querySelector("form").submit();
            });

            suggestionsBox.appendChild(listItem);
          });
        } catch (error) {
          console.error("Error fetching suggestions:", error);
        }
      });

      document.addEventListener("click", function (e) {
        if (
          !searchInput.contains(e.target) &&
          !suggestionsBox.contains(e.target)
        ) {
          suggestionsBox.innerHTML = "";
          suggestionsBox.style.display = "none";
        }
      });
    });
  </script>
</main>
